# shellcheck shell=bash disable=SC2034,SC2154,SC2086,SC2206
pkgname=shfmt
pkgver=3.12.0
pkgrel=1
pkgdesc="A shell parser, formatter, and interpreter with bash support"
arch=('x86_64' 'aarch64' 'i686' 'armv7h')
url="https://github.com/mvdan/sh"
license=('BSD-3-Clause')
makedepends=('go')
provides=('shfmt' 'gosh')
conflicts=('shfmt' 'gosh')
source=("${url}/archive/v${pkgver}.tar.gz")
sha512sums=('1dac0864c9e7a2e162463baff65514632ae787d6344f4cdaaafc77ce880a8a1c4a5756924c11b1f9f80411f61ab51a3b806ed314a3e1a3ec2a27c7e24ecef843')

build() {
  cd "${srcdir}/sh-${pkgver}"
  export CGO_ENABLED=0
  export GOFLAGS="-buildmode=pie -trimpath -mod=readonly -modcacherw"
  
  # Build shfmt
  go build -trimpath -ldflags="-s -w -X main.version=${pkgver}" \
    -o shfmt ./cmd/shfmt
  
  # Build gosh
  go build -trimpath -ldflags="-s -w" \
    -o gosh ./cmd/gosh
}

package() {
  cd "${srcdir}/sh-${pkgver}"
  
  # Install shfmt
  install -Dm755 shfmt "${pkgdir}/usr/bin/shfmt"
  
  # Install gosh
  install -Dm755 gosh "${pkgdir}/usr/bin/gosh"
  
  # Install license
  install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}

